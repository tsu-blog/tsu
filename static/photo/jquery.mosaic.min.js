!function($){$.Mosaic=function(t,e){var n,o,h=this;h.el=t,h.$el=$(t),h.$el.data("Mosaic",h);var i=!1;h.init=function(){h.options=n=$.extend({},$.Mosaic.defaults,h.$el.data(),e),$(h.el).addClass("jQueryMosaic"),n.outerMargin&&$(h.el).css("padding",n.outerMargin),n.innerGap&&$(h.el).css("margin-bottom",-1*n.innerGap),h.getItems().each(function(t,e){$(e).attr("width")&&$(e).width($(e).attr("width")),$(e).attr("height")&&$(e).height($(e).attr("height"))}),h.fit(),n.refitOnResize&&$(window).on("resize",null,null,function(){n.refitOnResizeDelay?(i&&clearTimeout(i),i=setTimeout(function(){h.fit()},n.refitOnResizeDelay)):h.fit()})},h.getItems=function(){return $("> div:not([data-no-mosaic=true]), > a:not([data-no-mosaic=true]), > img:not([data-no-mosaic=true])",h.el)},h.getItemAtIndex=function(t){return!!h.getItems()[t]&&$(h.getItems()[t])},h.getItemsSubset=function(t,e){var i=h.getItems();return e||(e=i.length-t),!(t>i.length)&&(t+e>i.length&&(e=i.length-t),i.slice(t,t+e))},h.isLastItemsSubset=function(t,e){var i=h.getItems();return t>i.length||t+e>i.length},h.getItemWidth=function(t){return $(t).outerWidth()?$(t).outerWidth():$(t).attr("width")?$(t).attr("width"):void 0},h.getItemHeight=function(t){return $(t).outerHeight()?$(t).outerHeight():$(t).attr("height")?$(t).attr("height"):void 0},h.getItemAspectRatio=function(t){if($(t).data("aspect-ratio"))return $(t).data("aspect-ratio");if(h.getItemWidth(t)&&h.getItemHeight(t)){var e=h.getItemWidth(t)/h.getItemHeight(t);return $(t).data("aspect-ratio",e),e}return n.defaultAspectRatio},h.getItemWidthForGivenHeight=function(t,e){return e*h.getItemAspectRatio(t)},h.getItemHeightForGivenWidth=function(t,e){return e/h.getItemAspectRatio(t)},h.setItemSizeByGivenHeight=function(t,e,i){var a=Math.floor(h.getItemWidthForGivenHeight(t,e));if($(t).width(a+"px"),i?$(t).height("auto"):$(t).height(Math.floor(e)),n.highResImagesWidthThreshold)if(a>n.highResImagesWidthThreshold){var s=$(t).data("high-res-background-image-url");s&&!$(t).data("low-res-background-image-url")&&($(t).data("low-res-background-image-url",$(t).css("background-image")),$(t).css("background-image",'url("'+s+'")'),$(t).addClass("highRes")),$("img",t).add(t).each(function(t,e){var i=$(e).data("high-res-image-src");i&&!$(e).data("low-res-image-src")&&($(e).data("low-res-image-src",$(e).attr("src")),$(e).attr("src",i),$(e).addClass("highRes"))})}else{var r=$(t).data("low-res-background-image-url");r&&($(t).css("background-image",r),$(t).data("low-res-background-image-url",!1),$(t).removeClass("highRes")),$("img",t).add(t).each(function(t,e){var i=$(e).data("low-res-image-src");i&&($(e).attr("src",i),$(e).data("low-res-image-src",!1),$(e).removeClass("highRes"))})}return a},h.calculateHeightToFit=function(t){var e=0;return t.each(function(){e+=parseFloat(h.getItemAspectRatio(this))}),(o-n.innerGap*(t.length-1))/e},h.retrieveBaseWidth=function(){var t=parseFloat($(h.el).width());o=$.isNumeric(t)?t:0},h.isBelowResponsiveWidthThreshold=function(){return n.responsiveWidthThreshold&&o<n.responsiveWidthThreshold},h.fit=function(){if(h.retrieveBaseWidth(),h.isBelowResponsiveWidthThreshold())h.getItems().each(function(){var t=h.getItemHeightForGivenWidth(this,o);$(this).width(o),$(this).data("only-force-height-when-necessary")?$(this).height("auto"):$(this).height(t),n.innerGap&&$(this).css("margin-bottom",n.innerGap)});else{for(var t,e=1,i=0,a=!1,s=1;;){if(t=h.getItemsSubset(i,e),h.isLastItemsSubset(i,e)){t.length&&h.fitItems(t);break}if(h.calculateHeightToFit(t)>n.maxRowHeight)e++;else{if(h.fitItems(t),i+=e,e=1,a=!0,!h.isBelowResponsiveWidthThreshold()&&n.maxRows&&s==n.maxRows)return void h.getItemsSubset(i).each(function(){$(this).hide()});s++}}a||h.fitItems(h.getItems())}},h.fitItems=function(e){var i=!1,a=h.calculateHeightToFit(e);if(a>n.maxRowHeight)switch(n.maxRowHeightPolicy){case"skip":return void e.each(function(){$(this).hide()});case"crop":a=n.maxRowHeight;break;case"oversize":i=!0;break;case"tail":a=n.maxRowHeight;var t=!0}e.each(function(){$(this).show()});var s=0;if(e.each(function(t){s+=h.setItemSizeByGivenHeight(this,a,i&&$(this).data("only-force-height-when-necessary")),n.innerGap&&($(this).css("margin-right",t<e.length-1?n.innerGap:0),$(this).css("margin-bottom",n.innerGap))}),!t&&s!=o-(e.length-1)*n.innerGap){difference=o-(e.length-1)*n.innerGap-s;var r=e.last().width();e.last().width(r+difference)}},h.init()},$.Mosaic.defaults={maxRowHeight:400,refitOnResize:!0,refitOnResizeDelay:!1,defaultAspectRatio:1,maxRowHeightPolicy:"skip",maxRows:!1,highResImagesWidthThreshold:350,outerMargin:0,innerGap:0,responsiveWidthThreshold:!1},$.fn.Mosaic=function(options,params){return this.each(function(){var me=$(this).data("Mosaic");(typeof options).match("object|undefined")?new $.Mosaic(this,options):eval("me."+options)(params)})}}(jQuery);